<?php
// Incluir el archivo que contiene la función de conexión
include("../modelo/datos_conexion.php");
include("../modelo/modelo.php");
session_start();

// Llamar a la función que devuelve el enlace a la base de datos
$enlace = obtenerConexion();

if (!empty($_POST["btningresar"])) {
    $usuario = $_POST["usuario"];
    $password = $_POST["contraseña"];

    if (empty($usuario) || empty($password)) {
        echo '<div class="alert alert-danger">LOS CAMPOS ESTÁN VACÍOS</div>';
    } else {
        // Consulta para verificar el login y obtener el nombre
        $q = "SELECT nombre FROM usuarios WHERE usuario = '$usuario' AND contraseña = '$password'";
        $consulta = mysqli_query($enlace, $q);
        
        if ($consulta && mysqli_num_rows($consulta) > 0) {
            $row = mysqli_fetch_assoc($consulta);
            $_SESSION['username'] = $row['nombre']; // Almacena el nombre en la sesión
            echo '<div class="alert alert-success">Login exitoso</div>';
            header("Location: index.php");
            exit(); // Detiene el script después de la redirección
        } else {
            echo '<div class="alert alert-danger">Usuario o contraseña incorrectos</div>';
        }
    }
}
